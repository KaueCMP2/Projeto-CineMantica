<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cinemantica - Feed de Avaliações</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="stylesheet" href="~/css/home.css">
</head>

<body>
    <header class="main-header">
        <button class="hamburger active-button"></button>
        <a href="../Tela home/index.html" class="barra-topo">
            <img src="~/assets/Cadastro-images/logo.png" alt="Logotipo Cinemantica" class="logo">
        </a>
        <nav class="main-nav">
            <div class="acoes-header">
                <div class="barra-pesquisa">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" placeholder="Busque aqui...">
                </div>
                <div class="acoes-usuario">
                    <div class="notificacao-usuario">
                        <i class="fas fa-bell action-icon"></i>
                        <div class="notification-dot"></div>
                    </div>
                    <div class="user-profile-container">
                        <div class="icone-usuario" id="user-icon">
                            <i class="fas fa-user profile-icon"></i>
                        </div>
                        <div class="user-dropdown" id="user-dropdown">
                            <a href="Views/Login/Index.cshtml">Fazer login</a>
                            <a href="Views/Cadastro/Index.cshtml">Criar conta</a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <div class="content-wrapper">
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="Views/Home/Index.cshtml"><i class="fas fa-home"></i> Home</a></li>
                    <li><a href="Views/Seguindo/index.cshtml"><i class="fas fa-users"></i> Seguindo</a></li>
                    <li><a href="Views/Perfil/index.cshtml"><i class="fas fa-user"></i> Perfil</a></li>
                    <li><a href="Views/Destaques/destaques.cshtml"><i class="fas fa-film"></i> Filmes em Destaque</a></li>
                    <li><a href="Views/Avaliacoes/feed_avaliacoes.cshtml"class="active"><i class="fas fa-star"></i> Avaliações</a>
                    </li>
                </ul>
            </nav>
            <div class="following-section">
                <div class="following-header">
                    <h3>Seguindo</h3>
                    <span>Assistidos</span>
                </div>
                <ul class="following-list">
                    <!-- Dynamic List -->
                    <li style="padding: 10px; color: #aaa;">Carregando...</li>
                </ul>
                <button class="see-more-btn">
                    <i class="fas fa-chevron-down"></i> Ver mais
                </button>
            </div>
        </aside>

        <main class="main-content following-page-content">
            <h2 class="section-title" style="margin-left: 20px; margin-top: 20px;">Feed Global de Avaliações</h2>

            <section class="feed-container">
                <!-- Dynamic Feed -->
                <div style="text-align: center; padding: 40px; color: #aaa;">
                    <p>Carregando avaliações...</p>
                </div>
            </section>

        </main>
    </div>

    <!-- Modal de Detalhes do Filme (Reutilizado) -->
    <div id="reviewModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeModalBtn">&times;</button>
            <div class="modal-left">
                <h2 class="modal-movie-title" id="modalMovieTitle">Título do Filme</h2>
                <p class="modal-description" id="modalMovieOverview">Sinopse do filme...</p>

                <div class="modal-ratings">
                    <div class="rating-box">
                        <span class="rating-label">Geral</span>
                        <div class="rating-value" id="modalMovieRating">
                            <!-- Nota Geral será inserida aqui -->
                        </div>
                    </div>
                    <div class="rating-box">
                        <span class="rating-label">Amigos</span>
                        <div class="rating-value" id="modalFriendsRating">
                            0 <i class="far fa-star" style="color: red;"></i>
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="modal-btn">Fazer nova Avaliação</button>
                    <button class="modal-btn">Ver Avaliações</button>
                </div>
            </div>
            <div class="modal-right">
                <img src="" alt="Poster do Filme" class="modal-poster" id="modalMoviePoster">
            </div>
        </div>
    </div>

    <script src="~/js/home/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const feedContainer = document.querySelector('.feed-container');
            const allReviews = JSON.parse(localStorage.getItem('reviews')) || [];

            if (allReviews.length > 0) {
                feedContainer.innerHTML = '';
                // Sort by date (newest first) - assuming date string is comparable or we parse it
                // Simple reverse for now as they are pushed chronologically
                allReviews.reverse().forEach(review => {
                    const reviewCard = document.createElement('article');
                    reviewCard.className = 'review-card';
                    reviewCard.innerHTML = `
                        <div class="review-header">
                            <div class="user-info">
                                <img src="${review.userAvatar}" alt="User Avatar">
                                <div class="user-details">
                                    <span class="username">${review.user}</span>
                                    <a href="../Tela Perfil/index.html?user=${review.userId || review.user}" class="view-profile-link">Ver perfil</a>
                                </div>
                            </div>
                            <button class="review-tag">Resenha</button>
                        </div>
                        <div class="review-body">
                            <img src="${review.moviePoster}" alt="${review.movieTitle}" class="review-movie-poster">
                            <div class="review-content">
                                <h3 class="review-movie-title">${review.movieTitle}</h3>
                                <div class="review-rating">
                                    ${getStarsHtml(review.rating)}
                                </div>
                                <p class="review-description">${review.text}</p>
                            </div>
                        </div>
                    `;
                    feedContainer.appendChild(reviewCard);
                });
            } else {
                feedContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #aaa;">
                        <i class="fas fa-film" style="font-size: 3em; margin-bottom: 20px;"></i>
                        <p>Nenhuma avaliação encontrada na plataforma.</p>
                    </div>
                `;
            }
        });

        function getStarsHtml(rating) {
            let html = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) {
                    html += '<i class="fas fa-star" style="color: red;"></i>';
                } else {
                    html += '<i class="far fa-star"></i>';
                }
            }
            return html;
        }
    </script>
</body>

</html>